<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>大数据基础介绍 | lishu的妙妙屋</title><meta name="author" content="lishu"><meta name="copyright" content="lishu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="大数据基础介绍 Hadoop组件  hdfs 分布式文件系统 多台计算机联网工作，也被称为一个集群，就像单台系统一样可以解决某些问题，这样的系统存储为分布式系统 横跨多台计算机进行工作，存储在分布式文件系统上的数据会自动分布在不同节点上 分离元数据和数据：nameNode和DataNode   在HDFS中，nameNode是元数据存储，DataNode集群是实际的数据存储，拿出一台或者多台机器来">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据基础介绍">
<meta property="og:url" content="http://example.com/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/index.html">
<meta property="og:site_name" content="lishu的妙妙屋">
<meta property="og:description" content="大数据基础介绍 Hadoop组件  hdfs 分布式文件系统 多台计算机联网工作，也被称为一个集群，就像单台系统一样可以解决某些问题，这样的系统存储为分布式系统 横跨多台计算机进行工作，存储在分布式文件系统上的数据会自动分布在不同节点上 分离元数据和数据：nameNode和DataNode   在HDFS中，nameNode是元数据存储，DataNode集群是实际的数据存储，拿出一台或者多台机器来">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/butterfly-icon.jpg">
<meta property="article:published_time" content="2025-07-09T12:05:19.641Z">
<meta property="article:modified_time" content="2025-07-16T12:06:07.344Z">
<meta property="article:author" content="lishu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "大数据基础介绍",
  "url": "http://example.com/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/",
  "image": "http://example.com/img/butterfly-icon.jpg",
  "datePublished": "2025-07-09T12:05:19.641Z",
  "dateModified": "2025-07-16T12:06:07.344Z",
  "author": [
    {
      "@type": "Person",
      "name": "lishu",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '大数据基础介绍',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"></ul></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/background.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/background.jpg" alt="Logo"><span class="site-name">lishu的妙妙屋</span></a><a class="nav-page-title" href="/"><span class="site-name">大数据基础介绍</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"></ul></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">大数据基础介绍</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-09T12:05:19.641Z" title="发表于 2025-07-09 20:05:19">2025-07-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-16T12:06:07.344Z" title="更新于 2025-07-16 20:06:07">2025-07-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>大数据基础介绍</h1>
<h2 id="Hadoop组件">Hadoop组件</h2>
<p><img src="image/hadoop01.png" alt=""></p>
<h3 id="hdfs">hdfs</h3>
<h5 id="分布式文件系统">分布式文件系统</h5>
<p>多台计算机联网工作，也被称为一个集群，就像单台系统一样可以解决某些问题，这样的系统存储为分布式系统<br>
横跨多台计算机进行工作，存储在分布式文件系统上的数据会自动分布在不同节点上</p>
<h5 id="分离元数据和数据：nameNode和DataNode">分离元数据和数据：nameNode和DataNode</h5>
<ul>
<li>
<p>在HDFS中，nameNode是元数据存储，DataNode集群是实际的数据存储，拿出一台或者多台机器来保存元数据，而剩下的内容来保存文件的实际内容</p>
</li>
<li>
<p>nameNode不仅要存储管理在HDFS上内容的元数据，而且要记录一些数据，比如哪些节点是集群的一部分，某个文件有几份副本等，还要决定当系统宕机时或者数据副本丢失时需要做哪些准备</p>
</li>
<li>
<p>存储到文件系统中的每个文件有关联的元数据，元数据包括文件名、节点数（Node）、数据块位置，数据则是真正的数据文件</p>
<p><img src="image/hadoop02.png" alt=""></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ①列出路径指定的目录中的内容</span></span></span><br><span class="line"> hdfs dfs -ls &lt;path&gt;</span><br><span class="line">例：hdfs dfs -ls hdfs://hdp2-dios//user/dataset/tmp/testA/20230327/gztable</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ②删除路径标识的文件或目录</span></span></span><br><span class="line"> hdfs dfs -rm -r &lt;path&gt;</span><br><span class="line">例：hdfs dfs -rm -r  hdfs://hdp2-dios//user/dataset/tmp/testA/testHadoop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ③在HDFS复制src中的文件或目录到dest</span></span></span><br><span class="line"> hdfs dfs -cp  &lt;src&gt; &lt;dest&gt;</span><br><span class="line">例：hdfs dfs -cp hdfs://hdp2-dios/user/dataset/tmp/testA/20230327/gztable/pn_md5_sha256.txt.gz hdfs://hdp2-dios//user/dataset/tmp/testA/testHadoop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ④从本地localSrc文件系统中的HDFS标识文件或目录内复制到dest</span></span></span><br><span class="line"> hdfs dfs -put &lt;localSrc&gt; &lt;dest&gt;</span><br><span class="line">例：hdfs dfs -put pn_md5_sha256.txt hdfs://hdp2-dios//user/dataset/tmp/testA/testHadoop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看下沙集群lis.db下的占用数据容量</span></span></span><br><span class="line"> hdfs dfs -du -h hdfs://hzxs-bi-hadoop-ds/user/hive/warehouse/lis.db/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看该表的创建信息</span></span></span><br><span class="line"> show create table xxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ⑥输出hdfs文件内容</span></span></span><br><span class="line"> hdfs dfs -text/-cat &lt;path&gt;</span><br><span class="line">例：hdfs dfs -cat hdfs://hdp2-dios/user/dataset/tmp/testA/20230327/gztable/pn_md5_sha256.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ⑦创建一个HDFS命名的目录路径</span></span></span><br><span class="line"> hdfs dfs -mkdir &lt;path&gt;</span><br><span class="line">例：hdfs dfs -mkdir hdfs://hdp2-dios//user/dataset/tmp/testA/testHadoop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开放数据路径权限``777``---给所有人</span></span></span><br><span class="line"> hdfs dfs -chmod 777 hdfs:``//hzxs-bi-hadoop-ds/user/lis/wifimac1.py</span><br></pre></td></tr></table></figure>
<h3 id="MapReduce">MapReduce</h3>
<p>是一个基于集群的计算平台，是一个简化分布式编程的计算框架，是一个将分布式编程抽取为map和Reduce的两个阶段的编程模型<br>
<img src="image/mapreduce.png" alt=""></p>
<h4 id="Map处理任务">Map处理任务</h4>
<p>1、读取HDFS中的文件，每一行解析成为一对&lt;key,value&gt;,每一个键值对调用一个map函数<br>
2、重写map()，对第一步得到的&lt;k,v&gt;进行处理，得到一个新的&lt;k,v&gt;输出<br>
3、对输出的&lt;k,v&gt;进行分区<br>
4、对不同分区的数据，按照key进行升序，分组，相同key的value放在同一个集合<br>
5、对分组后的数据进行归约</p>
<h4 id="Reduce任务处理">Reduce任务处理</h4>
<p>1、多个map任务的输出，按照不同的分区，通过网络复制到不同的reduce节点上<br>
2、对多个map的输出进行合并，排序<br>
3、重写reduce()函数，对输入的key、value进行处理，输出新的key、value<br>
4、把reduce的输出保存到文件中</p>
<h3 id="Hive">Hive</h3>
<p>hadoop的一个数据仓库处理工具，将hdfs底层存储的文件映射成一张张数据库表，可提供sql查询功能，本质是将sql语句转换成MapReduce程序<br>
<img src="image/hive01.png" alt=""><br>
<img src="image/hive02.png" alt=""></p>
<ul>
<li>第一部分：Hive接口
<ul>
<li>CLi：命令行输入HQL，执行语句</li>
<li>JDBC/ODBC：使用相关API连接Thrift Server，然后通过代码程序实现（开发模式）</li>
<li>WEB GUI：页面上操作，只有查询能使用</li>
</ul>
</li>
<li>第二部分：Driver驱动程序（核心部分）
<ul>
<li>接收来自Hive接口的命令</li>
<li>解析（解析sql语句是否正确）</li>
<li>编译（编译生成hive能执行的计划）</li>
<li>优化执行计划（生成最佳任务）</li>
</ul>
</li>
<li>第三部分：Hadoop
<ul>
<li>接收来自driver 的计划，调用MapReduce执行任务并返回结果</li>
</ul>
</li>
</ul>
<h4 id="操作使用">操作使用</h4>
<ul>
<li>一般是创建分区外表使用
<ul>
<li>分区可以不止一个，但具体使用时要考虑分隔符</li>
</ul>
</li>
<li>具体分区给予具体hdfs路径</li>
<li>映射的hdfs路径操作需要有对应权限</li>
</ul>
<h4 id="基本hive-sql">基本hive sql</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>，创建分区数据库表</span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> test (cid string) partitioned <span class="keyword">by</span> (<span class="keyword">day</span> <span class="type">int</span>);</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>，查验数据库列表</span><br><span class="line"> <span class="keyword">show</span> databases;</span><br><span class="line"> </span><br><span class="line"><span class="number">3.</span>使用数据库表</span><br><span class="line"> use database1;</span><br><span class="line"> </span><br><span class="line"><span class="number">4</span>，添加分区，并本地上传数据(或者指定hdfs路径数据)</span><br><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="type">date</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span>) location <span class="string">&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="number">5</span>，删除分区</span><br><span class="line"> <span class="keyword">ALTER TABLE</span> dms.tracklog_5min <span class="keyword">DROP</span> <span class="keyword">PARTITION</span>(<span class="keyword">DAY</span><span class="operator">=</span><span class="string">&#x27;20200428&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="number">6</span>，插入本地数据<span class="comment">---基本很少用</span></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/lis/test.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> 表名 <span class="keyword">partition</span>(<span class="keyword">day</span><span class="operator">=</span><span class="number">20180626</span>);</span><br><span class="line"> </span><br><span class="line"><span class="number">7</span>，查看表的详细信息</span><br><span class="line"> <span class="keyword">desc</span> formatted 表名 <span class="keyword">partition</span>(<span class="keyword">day</span><span class="operator">=</span><span class="number">20180625</span>)</span><br><span class="line"> </span><br><span class="line"><span class="number">8</span>，查看表的分区信息</span><br><span class="line"> <span class="keyword">show</span> partitions 表名</span><br><span class="line"> </span><br><span class="line"><span class="number">9</span>，修改表名</span><br><span class="line"> <span class="keyword">ALTER TABLE</span> 原表名 RENAME <span class="keyword">TO</span> 修改表;</span><br><span class="line"> </span><br><span class="line"><span class="number">10</span>，新增字段</span><br><span class="line"> <span class="keyword">alter table</span> 表名 <span class="keyword">add</span> columns(original_union_id string);</span><br></pre></td></tr></table></figure>
<h4 id="常用hive-sql">常用hive sql</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#基本语法：</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">   <span class="keyword">from</span></span><br><span class="line">   <span class="keyword">where</span></span><br><span class="line">   <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">   <span class="keyword">having</span></span><br><span class="line">   <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">   limit</span><br><span class="line">   ;</span><br><span class="line">  </span><br><span class="line">#查看分区:   <span class="keyword">show</span> partitions table_name;  </span><br><span class="line">  </span><br><span class="line">#hive函数:      <span class="built_in">count</span>()  <span class="built_in">sum</span>()   <span class="built_in">count</span>(disticnt )   <span class="built_in">sum</span>(if(),,)  <span class="built_in">count</span>(<span class="keyword">distinct</span> if( , ,<span class="keyword">null</span>))</span><br><span class="line">               <span class="built_in">substring</span>()  split() concat_ws()  collect_set()  collect_list()  行转列 <span class="keyword">Lateral</span> <span class="keyword">View</span> explode()</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">#注意事项：</span><br><span class="line">   <span class="number">1.</span>查公共表时，一定要限制分区（例如：<span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20170401</span>）；否则会读取所有分区的数据，此时应立即终止<span class="keyword">SQL</span>。</span><br><span class="line">  </span><br><span class="line">   <span class="number">2.</span>对公共表进行limit查看数据时，不能加除了分区之外的其他<span class="keyword">where</span>条件，否则加了就会进行MR环节读取一整天的数据，速度慢。</span><br><span class="line">      <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> report_dw_mdp.dw_user_lastlogin <span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20170401</span> limit <span class="number">10</span>;   快</span><br><span class="line">      <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> report_dw_mdp.dw_user_lastlogin <span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20170401</span> <span class="keyword">and</span> app_id<span class="operator">=</span>&quot;X0LuNCmE6t6VuvA1b3EyW4&quot; limit <span class="number">10</span>;   慢</span><br><span class="line"> <span class="operator">/</span></span><br></pre></td></tr></table></figure>
<h4 id="实战hive-sql">实战hive sql</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> lis.work_add_mid_gid_2 <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> a.gid,homegeohash,homescore <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> gid <span class="keyword">from</span> bi_dws.gt_data_aggregation <span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20221008</span> <span class="keyword">group</span> <span class="keyword">by</span> gid)a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">(<span class="keyword">select</span> gid,homegeohash,homescore <span class="keyword">from</span> qa.work_add_mid)b</span><br><span class="line"><span class="keyword">on</span> a.gid<span class="operator">=</span>b.gid;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">create table</span> qa.work_add_mid <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> gid,</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> type<span class="operator">=</span><span class="string">&#x27;workAddr&#x27;</span> <span class="keyword">then</span> geohash  <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> wrokgeohash,</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> type<span class="operator">=</span><span class="string">&#x27;workAddr&#x27;</span> <span class="keyword">then</span> score  <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> wrokscore,</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> type<span class="operator">=</span><span class="string">&#x27;homeAddr&#x27;</span> <span class="keyword">then</span> geohash  <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> homegeohash,</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> type<span class="operator">=</span><span class="string">&#x27;homeAddr&#x27;</span> <span class="keyword">then</span> score  <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">end</span> <span class="keyword">as</span> homescore</span><br><span class="line"><span class="keyword">from</span> bi_dws.lbs_user_addr_gid_v4 <span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20221002</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> id,name,concat_ws(<span class="string">&#x27;,&#x27;</span>,collect_set(fruit)),concat_ws(‘,’,collect_set(amount))</span><br><span class="line"><span class="keyword">from</span> table_name <span class="keyword">group</span> <span class="keyword">by</span> id,name;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> gid <span class="keyword">from</span>  bi_dws.gt_gidinfo_3m <span class="keyword">lateral</span> <span class="keyword">view</span> explode(split(usertags,<span class="string">&#x27;,&#x27;</span>))ss <span class="keyword">as</span> tag</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20221008</span>  <span class="keyword">and</span> gid_source<span class="operator">!=</span><span class="string">&#x27;dpi&#x27;</span> <span class="keyword">and</span> substr(lastlogin_time,<span class="number">0</span>,<span class="number">10</span>)<span class="operator">&gt;=</span><span class="string">&#x27;2022-07-10&#x27;</span> <span class="keyword">and</span> substr(lastlogin_time,<span class="number">0</span>,<span class="number">10</span>)<span class="operator">&lt;=</span><span class="string">&#x27;2022-10-08&#x27;</span>  <span class="keyword">and</span> ((length(tag)<span class="operator">=</span><span class="number">9</span> <span class="keyword">and</span> tag <span class="keyword">like</span> <span class="string">&#x27;h%&#x27;</span>) <span class="keyword">or</span> tag<span class="operator">=</span><span class="string">&#x27;018100&#x27;</span> <span class="keyword">or</span> tag<span class="operator">=</span><span class="string">&#x27;018200&#x27;</span> <span class="keyword">or</span> tag<span class="operator">=</span><span class="string">&#x27;018300&#x27;</span> )<span class="keyword">group</span> <span class="keyword">by</span> gid)b;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">create table</span> lis.ip_all_groupby_test_cnt <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> ,<span class="built_in">row_number</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> gid <span class="keyword">order</span> <span class="keyword">by</span> cnt_sum <span class="keyword">desc</span>) <span class="keyword">as</span> rank</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">lis.ip_all_groupby_test)w</span><br><span class="line"><span class="keyword">where</span> rank<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">create table</span> lis.hw_gid <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> gid,home_addr,work_addr <span class="keyword">from</span> zhoudh.gt_data_aggregation_add_active <span class="keyword">where</span> <span class="keyword">day</span><span class="operator">=</span><span class="number">20221029</span></span><br><span class="line"><span class="keyword">and</span> home_addr <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span> work_addr <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">sort <span class="keyword">by</span> rand() limit <span class="number">50000</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">row_number</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> gid <span class="keyword">order</span> <span class="keyword">by</span> sum_cnt <span class="keyword">desc</span>)  <span class="keyword">as</span> rank</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">        (<span class="keyword">select</span> gid,city_code,<span class="built_in">sum</span>(<span class="built_in">cast</span>(cnt <span class="keyword">as</span> <span class="type">int</span>)) sum_cnt</span><br><span class="line">            <span class="keyword">from</span> qa.ip_hw_tmp <span class="keyword">group</span> <span class="keyword">by</span> gid,city_code)a</span><br><span class="line">        )b</span><br><span class="line"><span class="keyword">where</span> rank<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> qa.ip_hw_tmp_sum_tag <span class="keyword">where</span> tag <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span> substr(city_code,<span class="number">0</span>,<span class="number">4</span>)<span class="operator">=</span>substr(tag,<span class="number">-4</span>,<span class="number">4</span>);</span><br><span class="line"> </span><br><span class="line"># 计算该表的gid去重数</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> gid <span class="keyword">from</span> qa.living_tag_dalu  <span class="keyword">group</span> <span class="keyword">by</span> gid)a;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">lishu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/">http://example.com/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">lishu的妙妙屋</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/07/09/hello-world/" title="示例文章"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">示例文章</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new &quot;My New Post&quot; More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">lishu</div><div class="author-info-description">不会做产品的开发不是好测试</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">大数据基础介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hadoop%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">Hadoop组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hdfs"><span class="toc-number">1.1.1.</span> <span class="toc-text">hdfs</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.0.1.</span> <span class="toc-text">分布式文件系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%85%83%E6%95%B0%E6%8D%AE%E5%92%8C%E6%95%B0%E6%8D%AE%EF%BC%9AnameNode%E5%92%8CDataNode"><span class="toc-number">1.1.1.0.2.</span> <span class="toc-text">分离元数据和数据：nameNode和DataNode</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MapReduce"><span class="toc-number">1.1.2.</span> <span class="toc-text">MapReduce</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Map%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Map处理任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reduce%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">Reduce任务处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive"><span class="toc-number">1.1.3.</span> <span class="toc-text">Hive</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">操作使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AChive-sql"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">基本hive sql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8hive-sql"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">常用hive sql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98hive-sql"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">实战hive sql</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/09/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/" title="大数据基础介绍">大数据基础介绍</a><time datetime="2025-07-09T12:05:19.641Z" title="发表于 2025-07-09 20:05:19">2025-07-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/09/hello-world/" title="示例文章">示例文章</a><time datetime="2025-07-09T11:35:49.783Z" title="发表于 2025-07-09 19:35:49">2025-07-09</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By lishu</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>